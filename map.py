import numpy as np
import pandas as pd

feature_map = {
    "label": "HR-HPV型别",
    "C1": "民族",
    "C2": "婚姻状况",
    "C3": "年龄（20～29-1，30～39-2，40～49-3，50～59-4，60～69-5）",
    "C4": "病人状态",
    "C5": "吸烟状态",
    "C6": "吸烟指数",
    "C7": "尝试戒烟标志",
    "C8": "已戒烟标志",
    "I1": "戒烟年限",
    "C9": "被动吸烟",
    "C10": "清洗外阴频率",
    "C11": "职业",
    "C12": "学历",
    "C13": "BMI（<18.5-1;18.5~24-2;>24-3）",
    "I2": "腰臀比",
    "C14": "腰臀比（<0.85-1,>=0.85-2）",
    "I3": "家庭数",
    "C15": "人均年收入",
    "C16": "既往恶性肿瘤史",
    "C17": "既往免疫抑制史",
    "C18": "既往宫颈治疗史",
    "C19": "既往盆腔炎症性疾病",
    "C20": "既往阴道炎史",
    "C21": "阴道炎类型",
    "C22": "既往糖尿病史",
    "C23": "既往高血脂史",
    "C24": "服用抗凝药标志",
    "C25": "家族肿瘤病史1",
    "C26": "服用已烯雌酚标志",
    "C27": "月经初潮（<12岁-1，>=12岁-2）",
    "I4": "月经周期规律",
    "C28": "初次性生活年龄(<=20-1;21-25-2；>=26-3)",
    "C29": "初次分娩年龄（<18-1;18~35-2;>35-3）",
    "C30": "初次流产年龄（<18-1;18~35-2;>35-3）",
    "C31": "初次怀孕年龄（<18-1;18~35-2;>35-3）",
    "C32": "怀孕次数",
    "C33": "生产次数（<=2-1;>2-2）",
    "C34": "足月产次",
    "C35": "早产产次",
    "C36": "流产次数（<=2-1;>2-2）",
    "C37": "活产次数",
    "C38": "分娩方式",
    "C39": "避孕方式",
    "C40": "避孕药标志",
    "C41": "口服避孕药类型",
    "C42": "避孕药最长使用年限",
    "C43": "HRT治疗标志",
    "C44": "HRT最长使用年限",
    "C45": "使用节育器标志",
    "C46": "节育器使用时间",
    "C47": "性伴侣(1-1;2-2;>=3-3)",
    "C48": "月经间期出血",
    "C49": "阴道不适",
    "C50": "性交痛",
    "C51": "月经过多",
    "C52": "绝经后出血",
    "C53": "盆腔痛",
    "C54": "性交出血",
    "C55": "体重减轻",
    "C56": "知道宫颈癌",
    "C57": "知道宫颈癌筛查",
    "C58": "上次筛查标志",
    "C59": "上次筛查时间",
    "C60": "上次筛查项目",
    "C61": "目前筛查标志",
    "C62": "目前筛查频率",
    "C63": "细胞学检查次数",
    "C64": "HPV关系",
    "C65": "HPV检测次数",
    "C66": "HPV感染(既往？)",
    "C67": "TCT结果",
}

sparse_feature_list = [
"HR-HPV型别",
"民族（汉-1；少数民族-2）",
"婚姻状况（未婚-1；已婚-2；离异-3；分居-4；丧偶-5）",
"年龄（20～29-1，30～39-2，40～49-3，50～59-4，60～69-5）",
"病人状态（体检-1；门诊-2；住院-3）",
"吸烟状态（黄色为复吸 从未-1；被动-2；现在-3；戒烟-4）",
    # "C6": "被动吸烟（1:每周三次以上， 2:每周五次以上 ，3:少于一周一次）",
"清洗外阴频率（每两天以上一次-1；每两天一次-2；每天一次-3；每天一次以上-4）",
"职业（办事人员和办公室职员-1；国家机关、党群组织、企业、事业单位负责人-2；军人-3；农林渔牧水利业生产人员-4；专业技术人员-5；"
          "商业、服务业人员-6；生产、运输设备操作人员及有关人员-7；家庭妇女-8；不便分类的其他从业人员-9；）",
"学历（未正式上学-1；小学-2；初中-3；高中/职高/中专-4；本科/大专-5；研究生-6；）",
    # "I1": "BMI",
"BMI分类（<18.5-1;18.5~24-2;>24-3）",
    # "I2": "腰臀比",
"腰臀比分类（<0.85-1,>=0.85-2）",
"人均年收入（<10000-1;10000~60000-2;>60000-3）",
"既往恶性肿瘤史（无-0；宫颈癌-1；内膜癌-2；卵巢癌-3；乳腺癌-4；其他-5）",
"既往免疫疾病史（无-0；SLE-1；肾病-2；HIV-3；其他-4；）",
"既往宫颈治疗史（无-0；宫颈锥切-1；冷冻治疗、激光、微波治疗-2；全子宫切除-3；其他-4；）",
"既往盆腔炎症性疾病（无-0；有-1；）",
"既往阴道炎史（从未-0；偶尔-1；频繁-2）",
"阴道炎类型（细菌-1；念珠菌-2；滴虫性-3；老年性-4；其他-5；不详-6；无-0）",
"既往糖尿病史（无-0；糖尿病-1；糖耐量异常-2；不详-3）",
"服药标志（糖尿病）（无-0；口服药物-1；胰岛素-2）",
"高血脂史（无-0；临界-1；高血脂-2；不详-3）",
"是否服药（高血脂药）（无-0；有-1）",
"服用抗凝药标志（无-0；有-1）",
"家族肿瘤病史（1:宫颈癌； 3:卵巢癌；2:内膜癌；5:其他；4:乳腺癌；0:无）",
"服用已烯雌酚标志（无-0；有-1；不详-3）",
    # "I3": "月经初潮年龄",
"月经初潮分类（<12岁-1，>=12岁-2）",
    # "C27": "月经周期规律（规律-0；不规律-1）",
"是否绝经（否-0；是-1）",
    # "I4": "初次性生活年龄",
"初次性生活年龄分类(<18-1;18-25-2；>=26-3)",
# "初次分娩年龄分类（<18-1;18~35-2;>35-3）",
# "初次流产年龄分类（<18-1;18~35-2;>35-3）",
    # "C32": "初次怀孕年龄分类（<18-1;18~35-2;>35-3）",
 "怀孕次数分类（<=2-1;>2-2）",
# "生产次数分类（<=2-1;>2-2）",
    # "C35": "流产次数分类（<=2-1;>2-2）",
    # "C36": "分娩方式（阴道分娩-1；剖宫产-2）",
"避孕方式（未避孕-0；避孕套-1；避孕药-2；节育器-3；输卵管结扎-4；其它-5）",
"避孕药标志（否-0；是-1）",
    # "C39": "口服避孕药类型（1:不详； 2:雌孕激素联合短效避孕药； 3.单孕激素短效避孕药； 4.紧急避孕药； 5.长效避孕药）",
    # "C40": "避孕药最长使用年限（半年以内-1；一年以内-2；两年以内-3；三年以内-4；三年以上-5）",
# "HRT治疗标志（无-0；有-1）",
"使用节育器标志（否-0；是-1）",
    # "C43": "节育器使用时间（一年以内-1；三年以内-2；五年以内-3；十年以内-4；十年以上-5）",
"性伴侣个数(1-1;2-2;>=3-3)",
"月经间期出血（否-0；是-1）",
"阴道不适（否-0；是-1）",
"性交痛（否-0；是-1）",
"月经过多（否-0；是-1）",
"绝经后出血（否-0；是-1）",
"盆腔痛（否-0；是-1）",
"性交出血（否-0；是-1）",
"体重减轻（否-0；是-1）",
"知道宫颈癌（否-0；是-1）",
"知道宫颈癌筛查（否-0；是-1）",
"上次筛查标志（无-0；是-1）",
"上次筛查时间（一年内-1；三年内-2；五年内-3；五年以上-4）",
# "上次筛查项目（巴氏涂片-1；HPV-2；TCT-3；巴氏涂片+HPV-4；HPV+TCT-5；不详-6）",
    # "C58": "目前筛查频率（五年一次-1；三年一次-2；两年一次-3；一年一次-4；半年一次-5；其他-6）",
    # "C59": "细胞学检查次数（一次-1；两次以上-2；五次以上-3；不详-4）",
"宫颈癌和HPV关系（不知道-1；了解很少-2；比较了解-3）",
"HPV检测次数（从未-1；一次-2；两次以上-3；五次以上-4）",
"既往HPV感染（否-0；是-1；不详-2）",
]


dense_feature_list = [
    # "BMI",
    # "腰臀比",
    # "性伴侣个数",
]


new_feature_map = {
    "label": "HR-HPV型别",
    "C1": "民族（汉-1；少数民族-2）",
    "C2": "婚姻状况（未婚-1；已婚-2；离异-3；分居-4；丧偶-5）",
    "C3": "年龄（20～29-1，30～39-2，40～49-3，50～59-4，60～69-5）",
    "C4": "病人状态（体检-1；门诊-2；住院-3）",
    "C5": "吸烟状态（黄色为复吸 从未-1；被动-2；现在-3；戒烟-4）",
    "C6": "被动吸烟（1:每周三次以上， 2:每周五次以上 ，3:少于一周一次）",
    "C7": "清洗外阴频率（每两天以上一次-1；每两天一次-2；每天一次-3；每天一次以上-4）",
    "C8": "职业（办事人员和办公室职员-1；国家机关、党群组织、企业、事业单位负责人-2；军人-3；农林渔牧水利业生产人员-4；专业技术人员-5；"
          "商业、服务业人员-6；生产、运输设备操作人员及有关人员-7；家庭妇女-8；不便分类的其他从业人员-9；）",
    "C9": "学历（未正式上学-1；小学-2；初中-3；高中/职高/中专-4；本科/大专-5；研究生-6；）",
    # "I1": "BMI",
    "C10": "BMI分类（<18.5-1;18.5~24-2;>24-3）",
    # "I2": "腰臀比",
    "C11": "腰臀比分类（<0.85-1,>=0.85-2）",
    "C12": "人均年收入（<10000-1;10000~60000-2;>60000-3）",
    "C13": "既往恶性肿瘤史（无-0；宫颈癌-1；内膜癌-2；卵巢癌-3；乳腺癌-4；其他-5）",
    "C14": "既往免疫疾病史（无-0；SLE-1；肾病-2；HIV-3；其他-4；）",
    "C15": "既往宫颈治疗史（无-0；宫颈锥切-1；冷冻治疗、激光、微波治疗-2；全子宫切除-3；其他-4；）",
    "C16": "既往盆腔炎症性疾病（无-0；有-1；）",
    "C17": "既往阴道炎史（从未-0；偶尔-1；频繁-2）",
    "C18": "阴道炎类型（细菌-1；念珠菌-2；滴虫性-3；老年性-4；其他-5；不详-6；无-0）",
    "C19": "既往糖尿病史（无-0；糖尿病-1；糖耐量异常-2；不详-3）",
    "C20": "服药标志（糖尿病）（无-0；口服药物-1；胰岛素-2）",
    "C21": "高血脂史（无-0；临界-1；高血脂-2；不详-3）",
    "C22": "是否服药（高血脂药）（无-0；有-1）",
    "C23": "服用抗凝药标志（无-0；有-1）",
    "C24": "家族肿瘤病史（1:宫颈癌； 3:卵巢癌；2:内膜癌；5:其他；4:乳腺癌；0:无）",
    "C25": "服用已烯雌酚标志（无-0；有-1；不详-3）",
    # "I3": "月经初潮年龄",
    "C26": "月经初潮分类（<12岁-1，>=12岁-2）",
    "C27": "月经周期规律（规律-0；不规律-1）",
    "C28": "是否绝经（否-0；是-1）",
    # "I4": "初次性生活年龄",
    "C29": "初次性生活年龄分类(<18-1;18-25-2；>=26-3)",
    "C30": "初次分娩年龄分类（<18-1;18~35-2;>35-3）",
    "C31": "初次流产年龄分类（<18-1;18~35-2;>35-3）",
    "C32": "初次怀孕年龄分类（<18-1;18~35-2;>35-3）",
    "C33": "怀孕次数分类（<=2-1;>2-2）",
    "C34": "生产次数分类（<=2-1;>2-2）",
    "C35": "流产次数分类（<=2-1;>2-2）",
    "C36": "分娩方式（阴道分娩-1；剖宫产-2）",
    "C37": "避孕方式（未避孕-0；避孕套-1；避孕药-2；节育器-3；输卵管结扎-4；其它-5）",
    "C38": "避孕药标志（否-0；是-1）",
    "C39": "口服避孕药类型（1:不详； 2:雌孕激素联合短效避孕药； 3.单孕激素短效避孕药； 4.紧急避孕药； 5.长效避孕药）",
    "C40": "避孕药最长使用年限（半年以内-1；一年以内-2；两年以内-3；三年以内-4；三年以上-5）",
    "C41": "HRT治疗标志（无-0；有-1）",
    "C42": "使用节育器标志（否-0；是-1）",
    "C43": "节育器使用时间（一年以内-1；三年以内-2；五年以内-3；十年以内-4；十年以上-5）",
    "C44": "性伴侣个数(1-1;2-2;>=3-3)",
    "C45": "月经间期出血（否-0；是-1）",
    "C46": "阴道不适（否-0；是-1）",
    "C47": "性交痛（否-0；是-1）",
    "C48": "月经过多（否-0；是-1）",
    "C49": "绝经后出血（否-0；是-1）",
    "C50": "盆腔痛（否-0；是-1）",
    "C51": "性交出血（否-0；是-1）",
    "C52": "体重减轻（否-0；是-1）",
    "C53": "知道宫颈癌（否-0；是-1）",
    "C54": "知道宫颈癌筛查（否-0；是-1）",
    "C55": "上次筛查标志（无-0；是-1）",
    "C56": "上次筛查时间（一年内-1；三年内-2；五年内-3；五年以上-4）",
    "C57": "上次筛查项目（巴氏涂片-1；HPV-2；TCT-3；巴氏涂片+HPV-4；HPV+TCT-5；不详-6）",
    "C58": "目前筛查频率（五年一次-1；三年一次-2；两年一次-3；一年一次-4；半年一次-5；其他-6）",
    "C59": "细胞学检查次数（一次-1；两次以上-2；五次以上-3；不详-4）",
    "C60": "宫颈癌和HPV关系（不知道-1；了解很少-2；比较了解-3）",
    "C61": "HPV检测次数（从未-1；一次-2；两次以上-3；五次以上-4）",
    "C62": "既往HPV感染（否-0；是-1；不详-2）",
}

# sparse_feature_list = ['C2', 'C3', 'C12', 'C4', 'C5', 'C11', 'C13', 'C14', 'C15', 'C23', 'C25', 'C26', 'C45', 'C47',
#                        'C51', 'C55', 'C62', 'C57', 'C58', 'C59', 'C63', 'C64', 'C65', 'C66']
# dense_feature_list = ['I2']
# sparse_feature_list = ['C2', 'C3', 'C4', 'C5', 'C9', 'C8', 'C12', 'C25', 'C21', 'C24', 'C44', 'C42', 'C48', 'C52',
#                        'C54', 'C56', 'C55', 'C58', 'C59', 'C60', 'C61', 'C62']
# dense_feature_list = ['I1', 'I2', 'I3', 'I4']


def convert(file_name, sparse_feature_list, dense_feature_list):
    # Read the CSV file
    df = pd.read_csv(file_name)
    i = 1
    j = 1
    feature_map = {"HR-HPV型别": "label"}
    for feature in sparse_feature_list[1:]:
        feature_map[feature] = f'C{i}'
        i += 1
    for feature in dense_feature_list:
        feature_map[feature] = f'I{j}'
        j += 1
    print(feature_map)
    # Rename columns according to feature map
    df.rename(columns=feature_map, inplace=True)

    df.replace(to_replace=r'^\s*$', value=np.nan, regex=True, inplace=True)
    df.dropna(inplace=True, subset=[f'C{idx}' for idx in range(1, i)] + [f'I{idx}' for idx in range(1, j)])
    df = df.sample(frac=1)
    # Save the modified DataFrame back to CSV
    df.to_csv(f"modified_{file_name}", index=False)


if __name__ == '__main__':
    convert("row_data.csv", sparse_feature_list, dense_feature_list)
